local m={};m.ui={};local main_tab=Menu.Create("Heroes","Hero List","Meepo","Meepo","Saver");local combo_key=nil;local retreating_meepos={};local last_update_time=0;if main_tab then m.ui.enable_save=main_tab:Switch("Включить авто-побег",true);m.ui.enable_save:ToolTip("Если включено, Meepo с низким HP будут автоматически уходить на базу и не использоватся в комбо.");m.ui.hp_slider=main_tab:Slider("HP % для отступления",0,100,30,"%d%%");m.ui.hp_slider:ToolTip("Если HP Meepo упадет ниже этого %, он побежит на фонтан. Вернется в бой, когда HP станет значение слайдера + 10%.")end;combo_key=Menu.Find("Heroes","Hero List","Meepo","Main Settings","Hero Settings","Combo Key");local fountain_positions={[Enum.TeamNum.TEAM_RADIANT]=Vector(-7019,-6534,384),[Enum.TeamNum.TEAM_DIRE]=Vector(6846,6251,384)};m.OnUpdate=function()if not m.ui.enable_save or not m.ui.enable_save:Get()or not Engine.IsInGame()then return end;if not combo_key or not Input.IsKeyDown(combo_key:Get())then return end;local current_time=GlobalVars.GetCurTime();if current_time<last_update_time then return end;last_update_time=current_time+0.30;local local_hero=Heroes.GetLocal();if not local_hero or not Entity.IsAlive(local_hero)or NPC.GetUnitName(local_hero)~="npc_dota_hero_meepo"then return end;local local_player=Players.GetLocal();if not local_player then return end;local player_id=Player.GetPlayerID(local_player);local active_meepos_for_combo={};local retreat_hp_percent=m.ui.hp_slider:Get()/100.0;local return_hp_percent=math.min(1.0,retreat_hp_percent+0.10);local fountain_pos=fountain_positions[Entity.GetTeamNum(local_hero)];local has_shard=NPC.HasShard(local_hero);local all_meepos={};for _,npc in pairs(NPCs.GetAll())do if npc and Entity.IsAlive(npc)and NPC.GetUnitName(npc)=="npc_dota_hero_meepo"and not NPC.IsIllusion(npc)and NPC.IsControllableByPlayer(npc,player_id)then table.insert(all_meepos,npc)end end;if #all_meepos==0 then return end;for _,meepo in ipairs(all_meepos)do local meepo_index=Entity.GetIndex(meepo);local current_hp_percent=Entity.GetHealth(meepo)/Entity.GetMaxHealth(meepo);local petrify_ability=NPC.GetAbility(meepo,"meepo_petrify");local can_petrify=has_shard and petrify_ability and Ability.IsReady(petrify_ability);local is_megameepo=NPC.HasModifier(meepo,"modifier_meepo_megameepo");if is_megameepo or can_petrify then table.insert(active_meepos_for_combo,meepo);retreating_meepos[meepo_index]=nil;goto continue end;if retreating_meepos[meepo_index]then if current_hp_percent>=return_hp_percent then retreating_meepos[meepo_index]=nil;table.insert(active_meepos_for_combo,meepo)else if fountain_pos then NPC.MoveTo(meepo,fountain_pos)end end else if current_hp_percent<retreat_hp_percent then retreating_meepos[meepo_index]=true;if fountain_pos then Player.HoldPosition(local_player,meepo);NPC.MoveTo(meepo,fountain_pos)end else table.insert(active_meepos_for_combo,meepo)end end;::continue::end;Player.ClearSelectedUnits(local_player);if #active_meepos_for_combo>0 then for _,meepo in pairs(active_meepos_for_combo)do Player.AddSelectedUnit(local_player,meepo)end end end;m.OnGameEnd=function()last_update_time=0;retreating_meepos={}end;return m
